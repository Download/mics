{"version":3,"file":"mics.es.js","sources":["../src/index.js"],"sourcesContent":["export { mix, is, like }\r\n\r\nfunction mix(...args) {\r\n    // todo: refactor to make const\r\n    let superclass = !is(args[0], 'factory') && args.shift() || baseclass\r\n    let factory = (is(args[args.length-1], 'factory') && args.pop()) || derive\r\n\r\n    superclass = is(superclass, 'mixin') ? superclass.class : derive(superclass)\r\n    if (args.length) factory = (org => superclass => org(args.reduce((s,m) => m.mixin(s), superclass)))(factory)\r\n\r\n    function mixin(superclass) {\r\n        const result = is(superclass, mixin) ? superclass : factory(superclass)\r\n\r\n        if (mixin.classes.indexOf(result) === -1) mixin.classes.push(result)\r\n        return result\r\n    }\r\n\r\n    Object.defineProperties(mixin, {\r\n        classes: { value:[], writable:false },\r\n        mixins: { value:args, writable:false },\r\n    })\r\n\r\n    const Class = mixin(superclass)\r\n    const constructor = Class.hasOwnProperty('constructor')\r\n        ? Class.constructor.bind(Class)\r\n        : (...args) => new Class(...args)\r\n\r\n    Object.getOwnPropertyNames(Class).forEach(k => Object.defineProperty(constructor, k, { value: Class[k] }))\r\n\r\n    return Object.defineProperties(constructor, {\r\n        mixin: { value:mixin, writable:false },\r\n        class: { value: Class, writable:false },\r\n        interface: { get:(x => () => x ? x : x = getInterface(Class.prototype))() },\r\n    })\r\n}\r\n\r\nfunction is(x, type) {\r\n    if (typeof type == 'string') {\r\n        return type == 'class'\r\n            ? (\r\n                is(x, 'function') && (s => /^class\\s/.test(s)\r\n    || /^.*classCallCheck\\(/.test(s.replace(/^[^{]*{\\s*/,'').replace(/\\s*}[^}]*$/,'')))(x.toString())\r\n            )\r\n            : type == 'mixin'\r\n                ? is(x, 'function') && !!x.mixin\r\n                : type == 'factory'\r\n                    ? is(x, 'function') && !is(x, 'mixin') && !is(x, 'class') && x.length == 1\r\n                    : typeof x == type;\r\n    }\r\n\r\n    if (typeof x == 'object') {\r\n        if (x instanceof type) return true\r\n        if (type.class && x instanceof type.class) return true\r\n        if (type.mixin && type.mixin.classes) return type.mixin.classes.reduce((f,c) => f || is(x,c), false)\r\n    }\r\n    else if (typeof x == 'function') {\r\n        if (x.mixin && x.mixin.mixins.indexOf(type) !== -1) return true\r\n\r\n        let c = x\r\n\r\n        while (c !== Object) {\r\n            if (c === type || c === type.class) return true\r\n            if (type.mixin && type.mixin.classes && type.mixin.classes.indexOf(c) !== -1) return true\r\n            c = Object.getPrototypeOf(c.prototype).constructor\r\n        }\r\n    }\r\n\r\n    return false\r\n}\r\n\r\nfunction like(x, type) {\r\n    if (is(x, type)) return true\r\n\r\n    const itf = type.interface || (is(type, 'function') && getInterface(type.prototype))\r\n    const subject = is(x, 'function') ? x.interface || getInterface(x.prototype) : x\r\n\r\n    return itf && Object.keys(itf).reduce((f, k) => \r\n        f && (is(itf[k], 'function') ? is(subject[k], 'function') : k in subject), true\r\n    )\r\n}\r\n\r\nfunction getInterface(proto) {\r\n    return getPropertyNames(proto).reduce((o,k) => { o[k] = proto[k]; return o }, {})\r\n}\r\n\r\nfunction getPropertyNames(proto) {\r\n    const results = []\r\n\r\n    while (proto !== Object.prototype) {\r\n        Object.getOwnPropertyNames(proto).reduce((arr,k) => arr.indexOf(k) === -1 ? arr.push(k) && arr : arr, results)\r\n        proto = Object.getPrototypeOf(proto).constructor.prototype\r\n    }\r\n\r\n    return results\r\n}\r\n\r\nconst baseclass = class Object{}\r\nconst derive = superclass => ({}[superclass.name || 'Object'] = class extends superclass {})\r\n"],"names":["mix","args","superclass","is","shift","baseclass","factory","length","pop","derive","class","org","reduce","s","m","mixin","result","classes","indexOf","push","defineProperties","value","writable","Class","constructor","hasOwnProperty","bind","getOwnPropertyNames","forEach","Object","defineProperty","k","get","x","getInterface","prototype","type","test","replace","toString","f","c","mixins","getPrototypeOf","like","itf","interface","subject","keys","proto","getPropertyNames","o","results","arr","name"],"mappings":"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"}